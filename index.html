<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ПК-Консультант</title>
    <link rel="stylesheet" href="./css/style.css">

</head>

<body>

    <div class="matrix left"></div>
    <div class="matrix right"></div>

    <div class="header">
        <h1>ПК-КОНСУЛЬТАНТ</h1>
        <button class="lang-btn" id="langBtn">RU</button>
        <div class="subheading" id="subheading">Подбор комплектующих для ПК онлайн</div>
    </div>

    <div class="container">

        <button class="how-toggle" id="howToggle">Как пользоваться сайтом</button>

        <div class="how-content" id="howContent">
            <div class="how-inner">
                <p><strong>1.</strong> Введите бюджет который предпочитаете для сборки, учитывайте то что это сборка только системного блока без монитора!</p>
                <p><strong>2.</strong> Выберите производителя видеокарты или оставьте «Авто».</p>
                <p><strong>3.</strong> Выберите производителя процессора или оставьте «Авто».</p>
                <p><strong>4.</strong> Укажите задачи ПК — игры, работа или универсальный вариант.</p>
                <p><strong>5.</strong> Нажмите «Подобрать комплектующие» и дождитесь результата.</p>
                <p>Остальные страницы сайта носят информационный характер и помогают лучше разобраться в теме.</p>
            </div>
        </div>

        <div class="main-layout">

            <div>
                <p id="budgetLabel">Ваш бюджет (мин. 20 000 руб.):</p>
                <input type="number" id="budget" min="20000" placeholder="Введите сумму от 20 000">

                <p id="gpuLabel">Производитель видеокарты:</p>
                <div class="select" data-name="gpu">
                    <div class="select-btn">Авто</div>
                    <div class="select-list">
                        <div data-ru="Авто" data-en="Auto">Авто</div>
                        <div data-ru="NVIDIA" data-en="NVIDIA">NVIDIA</div>
                        <div data-ru="AMD" data-en="AMD">AMD</div>
                    </div>
                </div>

                <p id="cpuLabel">Производитель процессора:</p>
                <div class="select" data-name="cpu">
                    <div class="select-btn">Авто</div>
                    <div class="select-list">
                        <div data-ru="Авто" data-en="Auto">Авто</div>
                        <div data-ru="Intel" data-en="Intel">Intel</div>
                        <div data-ru="AMD" data-en="AMD">AMD</div>
                    </div>
                </div>

                <p id="tasksLabel">Задачи ПК:</p>
                <div class="select" data-name="tasks">
                    <div class="select-btn">Авто</div>
                    <div class="select-list">
                        <div data-ru="Авто" data-en="Auto">Авто</div>
                        <div data-ru="Игры" data-en="Gaming">Игры</div>
                        <div data-ru="Работа" data-en="Work">Работа</div>
                        <div data-ru="Игры и работа" data-en="Gaming & Work">Игры и работа</div>
                    </div>
                </div>

                <button id="generate">Подобрать комплектующие</button>
            </div>

            <div class="result-box" id="result"></div>

        </div>

        <div class="nav-buttons">
            <a href="index.html" class="nav-btn" id="navBuild">Сборка ПК</a>
            <a href="about.html" class="nav-btn" id="navAbout">Из чего состоит ПК</a>
            <a href="tips.html" class="nav-btn" id="navTips">Советы по сборке</a>
            <a href="top-components.html" class="nav-btn" id="navTop">Топ комплектующих</a>
        </div>
    </div>

    <div class="footer">© 2026 MiniKapi. Все права защищены.</div>

    <script>
        // MATRIX
        document.querySelectorAll('.matrix').forEach(side => {

            const SYMBOL_COUNT = 40; // оптимально для слабых ПК
            const symbols = [];

            for (let i = 0; i < SYMBOL_COUNT; i++) {

                const span = document.createElement('span');
                span.textContent = Math.random() > 0.5 ? '1' : '0';

                span.style.left = Math.random() * 100 + '%';
                span.style.transform = `translateY(${Math.random() * 100}vh)`;
                span.style.opacity = 0.6 + Math.random() * 0.3;

                side.appendChild(span);

                symbols.push({
                    el: span,
                    speed: 0.2 + Math.random() * 0.3,
                    y: Math.random() * 110
                });
            }

            function animate() {
                for (let s of symbols) {

                    s.y += s.speed;

                    if (s.y > 110) {
                        s.y = -5;
                        s.el.textContent = Math.random() > 0.5 ? '1' : '0';
                        s.el.style.left = Math.random() * 100 + '%';
                    }

                    s.el.style.transform = `translateY(${s.y}vh)`;
                }

                requestAnimationFrame(animate);
            }

            requestAnimationFrame(animate);
        });

        // SELECT
        document.querySelectorAll('.select').forEach(sel => {
            const btn = sel.querySelector('.select-btn');
            const list = sel.querySelector('.select-list');
            btn.onclick = () => {
                document.querySelectorAll('.select').forEach(s => s !== sel && s.classList.remove('open'));
                sel.classList.toggle('open');
            };
            list.querySelectorAll('div').forEach(opt => {
                opt.onclick = () => {
                    btn.textContent = opt.getAttribute('data-' + lang);
                    sel.classList.remove('open');
                };
            });
        });

        document.addEventListener('click', e => {
            if (!e.target.closest('.select')) {
                document.querySelectorAll('.select').forEach(s => s.classList.remove('open'));
            }
        });

        let lang = localStorage.getItem('lang') || 'ru';

        const dict = {
            ru: {
                h1: 'ПК-КОНСУЛЬТАНТ',
                subheading: 'Подбор комплектующих для ПК онлайн',
                budgetLabel: 'Ваш бюджет (мин. 20 000 руб.):',
                budgetPlaceholder: 'Введите сумму от 20 000',
                generate: 'Подобрать комплектующие',
                navBuild: 'Сборка ПК',
                navAbout: 'Из чего состоит ПК',
                navTips: 'Советы по сборке',
                navTop: 'Топ комплектующих',
                howBtn: 'Как пользоваться сайтом',
                howText: `
1. Введите бюджет который предпочитаете для сборки. Это сборка только системного блока без монитора.

2. Выберите производителя видеокарты или оставьте «Авто».

3. Выберите производителя процессора или оставьте «Авто».

4. Укажите задачи ПК — игры, работа или универсальный вариант.

5. Нажмите «Подобрать комплектующие» и дождитесь результата.

Остальные страницы сайта носят информационный характер и помогают лучше разобраться в теме.
                            `,
                minBudget: 20000
            },

            en: {
                h1: 'PC CONSULTANT',
                subheading: 'Online PC parts selection',
                budgetLabel: 'Your budget (min. $250):',
                budgetPlaceholder: 'Enter amount from $250',
                generate: 'Build PC',
                navBuild: 'Build PC',
                navAbout: 'What does a PC consist of?',
                navTips: 'Assembly Tips',
                navTop: 'Top Components',
                howBtn: 'How to use the site',
                howText: `
1. Enter the budget you prefer for the build. This is for the system unit only (no monitor).

2. Choose a GPU manufacturer or leave it on “Auto”.

3. Choose a CPU manufacturer or leave it on “Auto”.

4. Select the PC purpose — gaming, work or universal.

5. Click “Build PC” and wait for the result.

Other pages on the site are informational and help you better understand PC components.
                            `,
                minBudget: 250
            }
        };

        const langBtn = document.getElementById('langBtn');
        const howToggle = document.getElementById('howToggle');
        const howContent = document.getElementById('howContent');

        function applyLang() {
            document.querySelector('.header h1').textContent = dict[lang].h1;
            document.getElementById('subheading').textContent = dict[lang].subheading;
            document.getElementById('budgetLabel').textContent = dict[lang].budgetLabel;
            document.getElementById('budget').placeholder = dict[lang].budgetPlaceholder;
            document.getElementById('generate').textContent = dict[lang].generate;
            document.getElementById('navBuild').textContent = dict[lang].navBuild;
            document.getElementById('navAbout').textContent = dict[lang].navAbout;
            document.getElementById('navTips').textContent = dict[lang].navTips;
            document.getElementById('navTop').textContent = dict[lang].navTop;

            // ПЕРЕВОД КНОПКИ И ТЕКСТА
            howToggle.textContent = dict[lang].howBtn;
            howContent.querySelector('.how-inner').innerText = dict[lang].howText;

            langBtn.textContent = lang.toUpperCase();

            document.querySelectorAll('.select').forEach(sel => {
                sel.querySelectorAll('.select-list div').forEach(opt => {
                    opt.textContent = opt.getAttribute('data-' + lang);
                });
                sel.querySelector('.select-btn').textContent =
                    sel.querySelector('.select-list div:first-child')
                        .getAttribute('data-' + lang);
            });

            localStorage.setItem('lang', lang);
        }

        langBtn.onclick = () => {
            lang = (lang === 'ru') ? 'en' : 'ru';
            applyLang();
        };

        applyLang();

        // TOGGLE HOW SECTION
        howToggle.addEventListener('click', () => {
            howContent.classList.toggle('active');
        });

        // LOADING + TYPING
        async function typeText(el, text) {
            el.textContent = "";
            for (let i = 0; i < text.length; i++) {
                el.textContent += text[i];
                await new Promise(r => setTimeout(r, 15));
            }
        }

        function showLoading(el) {
            el.textContent = lang === 'ru'
                ? "⌛ Подбираем комплектующие..."
                : "⌛ Building parts...";
        }

        // GENERATE
        document.getElementById('generate').onclick = async () => {
            const result = document.getElementById('result');
            const budgetInput = document.getElementById('budget');
            const budget = parseInt(budgetInput.value);

            if (isNaN(budget) || budget < dict[lang].minBudget) {
                result.textContent = lang === 'ru'
                    ? "Минимальный бюджет 20 000 руб."
                    : "Minimum budget $250";
                return;
            }

            const values = {
                gpu: document.querySelector('.select[data-name="gpu"] .select-btn').textContent,
                cpu: document.querySelector('.select[data-name="cpu"] .select-btn').textContent,
                tasks: document.querySelector('.select[data-name="tasks"] .select-btn').textContent
            };

            showLoading(result);

            try {
                const res = await fetch("/api/build", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ budget, gpu: values.gpu, cpu: values.cpu, tasks: values.tasks, lang })
                });

                const data = await res.json();
                await typeText(result, data.result);

            } catch (err) {
                console.error(err);
                result.textContent = lang === 'ru'
                    ? "❌ Ошибка сервера. Попробуйте позже."
                    : "❌ Server error. Try later.";
            }
        };
    </script>

</body>
</html>
